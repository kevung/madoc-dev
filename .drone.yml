kind: pipeline
type: docker
name: default

steps:

- name: get_commit
  image: alpine/git
  commands:
  - git rev-parse --short HEAD > commit.txt
  - 'cat commit.txt'

- name: aspell
  image: facteurpat/aspell:latest
  commands:
  - cat ./aspell/lang.txt
  - bash ./aspell/check.sh
  - mkdir -p ./build

- name: pandoc
  image: pandoc/latex:latest
  commands:
  - cd ./pandoc
  - 'sh ./build.sh pdf $(cat ../NAME.md)_$(cat ../commit.txt)'
  - 'sh ./build.sh docx $(cat ../NAME.md)_$(cat ../commit.txt)'
  - cd ..
  - ls -ltr ./pandoc

- name: package
  image: alpine
  commands:
  - COMMIT=$(cat ./commit.txt)
  - NAME=$(cat ./NAME.md)
  - BUILD_FOLDER=build_$COMMIT
  - mkdir -p $BUILD_FOLDER
  - cp mispelled.txt $BUILD_FOLDER
  - cp pandoc/$NAME_$COMMIT.pdf $BUILD_FOLDER
  - cp pandoc/$NAME_$COMMIT.docx $BUILD_FOLDER
  - ls -ltr $BUILD_FOLDER

